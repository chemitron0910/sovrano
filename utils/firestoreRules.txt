rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    match /users/{userId} {
  		allow read: if request.auth != null;
  		allow update: if request.auth.uid == userId || isAdmin();
  		allow create: if request.auth != null;
  		allow delete: if isAdmin();
		}
    
    match /users/{userId}/availability/{date} {
  		allow read: if isAdmin() || isEmpleado();
  		allow write: if isAdmin() || (isEmpleado() && request.auth.uid == userId);
		}

    match /bookings/{bookingId} {
      allow read, write: if request.auth != null || isAdmin() || isEmpleado() || isUsuario();
    }
    
    match /services/{servicesId} {
  		allow read: if request.auth != null || isAdmin() || isEmpleado() || isUsuario();
  		allow write: if isAdmin();
		}
    
    function isAdmin() {
      return request.auth.token.role == 'admin';
    }

    function isEmpleado() {
      return request.auth.token.role == 'empleado';
    }
    
    function isUsuario() {
      return request.auth.token.role == 'usuario';
    }
  }
}
